@model WebPro.Models.Sources

@{
    ViewBag.Title = "源码编辑";
}

@section PageSpecificStyleSheetIncludes{
    <link href="~/assets/fileupload/css/fileinput.min.css" rel="stylesheet" type="text/css" />
}

<div class="content-side-right">
    <div class="container content-sm">
        <div class="post-comment">

            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(false)

                <fieldset>
                    <div class="headline">
                        <h3><i class="fa fa-plus"></i>编辑源码--@Model.title</h3>
                        &nbsp;
                        <a href="@Url.Action("Index")"><i class="fa  fa-reply"></i></a>
                    </div>

                    <div class="row margin-bottom-10">
                        <div class="col-md-7 col-md-offset-0">
                            <label>标题</label>
                            <input id="title" name="title" type="text" class="form-control" placeholder="title" value="@Model.title">
                            @Html.ValidationMessageFor(model => model.title)
                            <input id="author" name="author" type="hidden" class="form-control" placeholder="title" value="@Model.author">
                            @Html.ValidationMessageFor(model => model.author)
                            <input id="orderNum" name="orderNum" type="hidden" class="form-control" placeholder="title" value="@Model.orderNum">
                            @Html.ValidationMessageFor(model => model.orderNum)
                            <input id="downloadCount" name="downloadCount" type="hidden" class="form-control" placeholder="title" value="@Model.downloadCount">
                            @Html.ValidationMessageFor(model => model.downloadCount)
                        </div>
                        <div class="col-md-4 col-md-offset-0">
                            <label>关键字</label>
                            <input id="keyword" name="keyword" type="text" class="form-control" placeholder="keyword" value="@Model.keyword">
                            @Html.ValidationMessageFor(model => model.keyword)
                        </div>
                    </div>

                    <label>内容</label>
                    <div class="row margin-bottom-10">
                        <div class="col-md-11 col-md-offset-0">
                            <textarea id="content" name="content" class="form-control" rows="2" placeholder="content">@Model.content</textarea>
                            @Html.ValidationMessageFor(model => model.content)
                        </div>
                    </div>

                    <div class="row margin-bottom-10">
                        <div class="col-md-11 col-md-offset-0">
                            <label>附件</label>
                            <div class="form-group">
                                <input id="attachment" name="upfile" class="file-loading" type="file">
                            </div>
                            <input id="downloadPath" name="downloadPath" type="text" class="form-control" placeholder="Attachment" value="@Model.downloadPath">
                            @Html.ValidationMessageFor(model => model.downloadPath)
                        </div>
                    </div>
                    <div class="row margin-bottom-10">
                        <div class="col-md-11 col-md-offset-0">
                            <label>插图</label>
                            <div class="form-group">
                                <input id="images" name="upfile" class="file-loading" type="file" multiple data-show-upload="true">
                            </div>
                            <input id="imgurls" name="imgurls" type="text" class="form-control" placeholder="Illustration" value="@Model.imgurls">
                            @Html.ValidationMessageFor(model => model.imgurls)
                        </div>
                    </div>
                    @*<div class="row margin-bottom-10">
                            <div class="col-md-4 col-md-offset-0">
                                <label>插图</label>
                                <input id="imgurls" name="imgurls" type="text" class="form-control" placeholder="Illustration">
                                @Html.ValidationMessageFor(model => model.imgurls)
                            </div>
                            <div class="col-md-4 col-md-offset-0">
                                <label>日期</label>
                                <input id="publishTime" name="publishTime" type="datetime-local" class="form-control">
                                @Html.ValidationMessageFor(model => model.publishTime)
                            </div>
                            <div class="col-md-3 col-md-offset-0">
                                <label>作者</label>
                                <input id="author" name="author" type="text" class="form-control" value="zuorx">
                                @Html.ValidationMessageFor(model => model.author)
                            </div>
                        </div>

                        <div class="row margin-bottom-10">
                            <div class="col-md-4 col-md-offset-0">
                                <label>下载路径</label>
                                <input id="downloadPath" name="downloadPath" type="text" class="form-control">
                                @Html.ValidationMessageFor(model => model.downloadPath)
                            </div>
                            <div class="col-md-3 col-md-offset-0">
                                <label>排序</label>
                                <input id="orderNum" name="orderNum" type="text" class="form-control" value="0">
                                @Html.ValidationMessageFor(model => model.orderNum)
                            </div>
                            <div class="col-md-3 col-md-offset-0">
                                <label>下载数</label>
                                <input id="downloadCount" name="downloadCount" type="text" class="form-control" value="0">
                                @Html.ValidationMessageFor(model => model.downloadCount)
                            </div>
                        </div>*@

                    <p>
                        <input type="submit" class="btn-u" value="提 交" />
                    </p>
                </fieldset>
            }
        </div>
    </div>
</div>
@section PageSpecificJavascriptIncludes{
    <script type="text/javascript" src="~/assets/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="~/assets/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="~/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <!-- JS Customization -->
    <script type="text/javascript" src="~/assets/js/custom.js" charset="gbk"></script>

    <script type="text/javascript" src="~/assets/plugins/back-to-top.js"></script>
    <script type="text/javascript" src="~/assets/plugins/jquery-appear.js"></script>
    <script type="text/javascript" src="~/assets/plugins/smoothScroll.js"></script>
    <!-- JS Page Level -->
    <script type="text/javascript" src="~/assets/js/app.js"></script>

    <script src="~/assets/fileupload/js/fileinput.min.js" type="text/javascript"></script>
    <script src="~/assets/fileupload/js/fileinput_locale_zh.js" type="text/javascript"></script>

    @*<script type="text/javascript" src="~/assets/plugins/sky-forms-pro/skyforms/js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="~/assets/plugins/sky-forms-pro/skyforms/js/jquery.validate.min.js"></script>
        <script type="text/javascript" src="~/assets/plugins/sky-forms-pro/skyforms/js/jquery.maskedinput.min.js"></script>
        <script type="text/javascript" src="~/assets/js/forms/checkout.js"></script>*@
    <script type="text/javascript">
    jQuery(document).ready(function () {
        App.init();
        $("#sourceli").addClass("active");
        //BlogCheckForm.initBlogCheckForm();
    });

    $('#images').fileinput({
        language: 'zh', //设置语言
        uploadUrl: '/assets/ueditor/net/controller.ashx?action=uploadimage&sub=source', //上传的地址
        //deleteUrl: '/assets/ueditor/net/controller.ashx?action=deletefile',
        //allowedFileTypes: 'images',
        allowedFileExtensions: ['jpg', 'png', 'gif'],//接收的文件后缀
        showUpload: true, //是否显示上传按钮
        showCaption: true,//是否显示标题
        overwriteInitial: false,
        browseClass: "btn btn-primary", //按钮样式
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
        //initialDelimiter:",",
        initialPreviewShowDelete: true,
        initialPreviewDelimiter: "|",
        initialPreview: "@Html.Raw(ViewBag.initialPreview)",
        initialPreviewConfig: @Html.Raw(ViewBag.initialPreviewConfig),
            //initialPreview: ["<img src='/upload/image/20160317/6359382905724248496520280.jpg' class='file-preview-image'>",
            //    "<img src='/upload/image/20160317/6359382905189117882039574.jpg' class='file-preview-image'>"],

        });

        $('#attachment').fileinput({
            language: 'zh', //设置语言
            uploadUrl: '/assets/ueditor/net/controller.ashx?action=uploadfile&sub=source', //上传的地址
            showUpload: true, //是否显示上传按钮
            showCaption: true,//是否显示标题
            overwriteInitial: false,
            maxFileCount: 1,
            browseClass: "btn btn-primary", //按钮样式
            allowedPreviewTypes: 'images',
            previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
            initialPreviewShowDelete: true,
            initialPreview: "<div class='file-preview-text'>" +
                                "<h2><i class='glyphicon glyphicon-file'></i></h2></div>",
            initialPreviewConfig: [{
                key: 101,
                url:'/assets/ueditor/net/controller.ashx?action=deletefile',
                extra:{path:'@Model.downloadPath'},
                }],
            //showPreview:false,
        });

        $("#images").on("fileuploaded", function (event, data, previewId, index) {
            var da = data.response;
            var url = da.url;
            if ($("#imgurls").attr("value").length > 0)
                url = "|" + url;
            $("#imgurls").attr("value", $("#imgurls").attr("value") + url);
        });
        //$('#images').on('filepredelete', function(event, key,jqXHR,data) {
        //});
        $('#images').on('filedeleted', function(event, key,jqXHR,data) {
            var da = data;
            var temp=$("#imgurls").attr("value");
            temp=temp.replace(da.path,"");
            if(temp.length>0&&temp.substr(0,1)=="|")
                temp=temp.length==1?"":temp.substring(1,temp.length);
            if(temp.length>0 && temp.substr(-1)=="|")
                temp=temp.length==1?"":temp.substring(0,temp.length-1);

            $("#imgurls").attr("value", temp);
        });
        $("#attachment").on("fileuploaded", function (event, data, previewId, index) {
            var da = data.response;
            $("#downloadPath").attr("value", da.url);
        });
        $('#attachment').on('filedeleted', function(event, key,jqXHR,data) {
            $("#downloadPath").attr("value", "");
        });
    </script>
}
